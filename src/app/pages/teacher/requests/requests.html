<div class="space-y-6">
  <!-- Header -->
  <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-emerald-100 p-6">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Solicitudes de Ausencia</h2>
        <p class="text-gray-600">Revisa y aprueba las solicitudes de ausencia de estudiantes</p>
      </div>
      @if (pendingCount() > 0) {
        <div class="bg-yellow-100 text-yellow-700 px-4 py-2 rounded-full font-semibold">
          {{ pendingCount() }} pendiente{{ pendingCount() > 1 ? 's' : '' }}
        </div>
      }
    </div>
  </div>

  <!-- Status Tabs -->
  @if (!loading()) {
    <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-emerald-100 p-6">
      <div class="flex gap-2 overflow-x-auto">
        @for (tab of statusTabs; track tab.value) {
          <button
            type="button"
            (click)="selectStatus(tab.value)"
            [class]="
              'px-4 py-2 rounded-lg font-medium transition-all whitespace-nowrap ' +
              (selectedStatus() === tab.value
                ? 'bg-emerald-600 text-white'
                : 'bg-gray-100 text-gray-700 hover:bg-gray-200')
            "
          >
            {{ tab.label }}
          </button>
        }
      </div>
    </div>
  }

  <!-- Loading State -->
  @if (loading()) {
    <div
      class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-emerald-100 p-12 text-center"
    >
      <div
        class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-emerald-600 border-r-transparent mb-4"
      ></div>
      <p class="text-gray-600">Cargando solicitudes...</p>
    </div>
  }

  <!-- Requests List -->
  @if (!loading() && filteredRequests().length > 0) {
    <div class="grid grid-cols-1 gap-4">
      @for (request of filteredRequests(); track request.id) {
        <button
          type="button"
          class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-emerald-100 p-6 hover:shadow-2xl transition-shadow cursor-pointer w-full text-left"
          (click)="openDetail(request)"
        >
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <h3 class="text-lg font-semibold text-gray-900">{{ request.studentName }}</h3>
                <span
                  [class]="
                    'px-3 py-1 rounded-full text-xs font-semibold ' + getStatusColor(request.status)
                  "
                >
                  {{ getStatusLabel(request.status) }}
                </span>
              </div>
              <p class="text-sm text-gray-600 mb-2">{{ request.className }}</p>
              <div class="flex items-center gap-4 text-sm text-gray-700">
                <div class="flex items-center gap-1">
                  <span class="material-symbols-outlined text-sm">calendar_today</span>
                  <span>{{ formatDate(request.startDate) }}</span>
                  @if (request.startDate !== request.endDate) {
                    <span>-</span>
                    <span>{{ formatDate(request.endDate) }}</span>
                  }
                </div>
              </div>
              <p class="text-sm text-gray-600 mt-2 line-clamp-2">{{ request.reason }}</p>
            </div>
            <span class="material-symbols-outlined text-gray-400">chevron_right</span>
          </div>
        </button>
      }
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && filteredRequests().length === 0) {
    <div
      class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-emerald-100 p-12 text-center"
    >
      <div
        class="bg-gradient-to-br from-emerald-500 to-teal-600 p-6 rounded-2xl shadow-lg inline-block mb-4"
      >
        <span class="material-symbols-outlined text-white text-5xl">inbox</span>
      </div>
      <p class="text-xl text-gray-600 font-medium">No hay solicitudes</p>
      <p class="text-sm text-gray-500 mt-2">
        {{
          selectedStatus() === 'all'
            ? 'No tienes solicitudes de ausencia'
            : 'No hay solicitudes con este estado'
        }}
      </p>
    </div>
  }
</div>

<!-- Detail Modal -->
@if (showDetailModal() && selectedRequest()) {
  <div
    class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    role="dialog"
    aria-modal="true"
    (click)="closeDetail()"
    (keydown.escape)="closeDetail()"
  >
    <div
      class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl overflow-hidden max-h-[90vh] overflow-y-auto"
      role="document"
      (click)="$event.stopPropagation()"
      (keydown)="$event.stopPropagation()"
    >
      <!-- Modal Header -->
      <div class="bg-gradient-to-r from-emerald-600 to-teal-600 p-6">
        <h2 class="text-2xl font-bold text-white mb-1">Detalle de Solicitud</h2>
        <p class="text-emerald-100">{{ selectedRequest()!.studentName }}</p>
      </div>

      <!-- Modal Body -->
      <div class="p-6 space-y-6">
        <!-- Status -->
        <div>
          <span
            [class]="
              'inline-block px-4 py-2 rounded-full text-sm font-semibold ' +
              getStatusColor(selectedRequest()!.status)
            "
          >
            {{ getStatusLabel(selectedRequest()!.status) }}
          </span>
        </div>

        <!-- Info Grid -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-500 mb-1">Estudiante</p>
            <p class="font-medium text-gray-900">{{ selectedRequest()!.studentName }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500 mb-1">Clase</p>
            <p class="font-medium text-gray-900">{{ selectedRequest()!.className }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500 mb-1">Fecha de inicio</p>
            <p class="font-medium text-gray-900">{{ formatDate(selectedRequest()!.startDate) }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500 mb-1">Fecha de fin</p>
            <p class="font-medium text-gray-900">{{ formatDate(selectedRequest()!.endDate) }}</p>
          </div>
          <div class="col-span-2">
            <p class="text-sm text-gray-500 mb-1">Solicitado</p>
            <p class="font-medium text-gray-900">
              {{ formatTimestamp(selectedRequest()!.createdAt) }}
            </p>
          </div>
        </div>

        <!-- Reason -->
        <div>
          <p class="text-sm text-gray-500 mb-2">Razón</p>
          <div class="bg-gray-50 rounded-lg p-4">
            <p class="text-gray-900">{{ selectedRequest()!.reason }}</p>
          </div>
        </div>

        <!-- Attachment -->
        @if (selectedRequest()!.attachmentUrl) {
          <div>
            <p class="text-sm text-gray-500 mb-2">Archivo adjunto</p>
            <a
              [href]="selectedRequest()!.attachmentUrl"
              target="_blank"
              class="inline-flex items-center gap-2 text-emerald-600 hover:text-emerald-700 font-medium"
            >
              <span class="material-symbols-outlined text-sm">attach_file</span>
              Ver archivo
            </a>
          </div>
        }

        <!-- Review Notes (if pending) -->
        @if (selectedRequest()!.status === 'pending') {
          <div>
            <label for="review-notes" class="block text-sm font-medium text-gray-700 mb-2">
              Notas de revisión (opcional)
            </label>
            <textarea
              id="review-notes"
              [value]="reviewNotes()"
              (input)="reviewNotes.set($any($event.target).value)"
              rows="3"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
              placeholder="Agrega comentarios sobre tu decisión..."
            ></textarea>
          </div>
        }

        <!-- Reviewed Info (if reviewed) -->
        @if (selectedRequest()!.status !== 'pending') {
          <div class="bg-gray-50 rounded-lg p-4">
            <p class="text-sm text-gray-500 mb-2">Revisado</p>
            <p class="text-sm text-gray-900 mb-1">
              {{ formatTimestamp(selectedRequest()!.reviewedAt!) }}
            </p>
            @if (selectedRequest()!.reviewNotes) {
              <p class="text-sm text-gray-600 mt-2">{{ selectedRequest()!.reviewNotes }}</p>
            }
          </div>
        }
      </div>

      <!-- Modal Footer -->
      <div class="p-6 bg-gray-50 flex items-center justify-end gap-3">
        <app-button
          [variant]="'ghost'"
          [size]="'md'"
          (click)="closeDetail()"
          [disabled]="processing()"
        >
          Cerrar
        </app-button>
        @if (selectedRequest()!.status === 'pending') {
          <app-button
            [variant]="'outline'"
            [size]="'md'"
            (click)="rejectRequest()"
            [disabled]="processing()"
            class="text-red-600 border-red-600 hover:bg-red-50"
          >
            {{ processing() ? 'Procesando...' : 'Rechazar' }}
          </app-button>
          <app-button
            [variant]="'primary'"
            [size]="'md'"
            (click)="approveRequest()"
            [disabled]="processing()"
          >
            {{ processing() ? 'Procesando...' : 'Aprobar' }}
          </app-button>
        }
      </div>
    </div>
  </div>
}
