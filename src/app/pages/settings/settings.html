<!-- Hero Section -->
<app-section spacing="xl" background="blue">
  <div class="text-center max-w-4xl mx-auto">
    <h1 class="text-5xl md:text-6xl font-bold text-gray-900 mb-6">Configuración</h1>
    <p class="text-xl text-gray-700 mb-8">Gestiona la seguridad y preferencias de tu cuenta</p>
  </div>
</app-section>

<!-- Security Section -->
<app-section spacing="xl" background="white">
  <div class="max-w-3xl mx-auto">
    @if (isPasswordProvider()) {
      <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-blue-100 p-8">
        <div class="flex items-center gap-4 mb-6">
          <div class="bg-gradient-to-br from-blue-500 to-indigo-600 p-4 rounded-xl shadow-lg">
            <span class="material-symbols-outlined text-white text-4xl">lock</span>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-gray-900">Cambiar Contraseña</h2>
            <p class="text-gray-600 mt-1">Actualiza tu contraseña para mantener tu cuenta segura</p>
          </div>
        </div>

        <form (submit)="$event.preventDefault(); changePassword()" class="space-y-6">
          <!-- Current Password -->
          <div>
            <app-input
              [label]="'Contraseña Actual'"
              [type]="'password'"
              [placeholder]="'Tu contraseña actual'"
              [icon]="'lock'"
              [value]="currentPassword()"
              (valueChange)="currentPassword.set($event)"
              [required]="true"
              [invalid]="currentPassword().trim().length > 0 && currentPassword().trim().length < 8"
              [errorMessage]="'La contraseña debe tener al menos 8 caracteres'"
            />
          </div>

          <!-- New Password -->
          <div>
            <app-input
              [label]="'Nueva Contraseña'"
              [type]="'password'"
              [placeholder]="'Crea una contraseña'"
              [icon]="'vpn_key'"
              [value]="newPassword()"
              (valueChange)="newPassword.set($event)"
              [required]="true"
              [invalid]="newPassword().trim().length > 0 && passwordErrors().length > 0"
            />
          </div>

          <!-- Confirm Password -->
          <div>
            <app-input
              [label]="'Confirmar Nueva Contraseña'"
              [type]="'password'"
              [placeholder]="'Confirma tu contraseña'"
              [icon]="'check_circle'"
              [value]="confirmPassword()"
              (valueChange)="confirmPassword.set($event)"
              [required]="true"
              [invalid]="confirmPassword().trim().length > 0 && confirmPassword() !== newPassword()"
            />
          </div>

          <!-- Password Requirements -->
          @if (passwordErrors().length > 0) {
            <div class="text-sm text-red-600 space-y-1">
              <div>La contraseña debe incluir:</div>
              <ul class="list-disc ml-5">
                @for (e of passwordErrors(); track e) {
                  <li>{{ e }}</li>
                }
              </ul>
            </div>
          }

          @if (confirmPassword().trim() && confirmPassword() !== newPassword()) {
            <div class="text-sm text-red-600">Las contraseñas no coinciden</div>
          }

          <!-- Error Message -->
          @if (passwordError()) {
            <div
              class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2"
            >
              <span class="material-symbols-outlined">error</span>
              <span>{{ passwordError() }}</span>
            </div>
          }

          <!-- Success Message -->
          @if (passwordSuccess()) {
            <div
              class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2"
            >
              <span class="material-symbols-outlined">check_circle</span>
              <span>{{ passwordSuccess() }}</span>
            </div>
          }

          <!-- Submit Button -->
          <div>
            <app-button
              [variant]="'primary'"
              [size]="'lg'"
              [fullWidth]="true"
              [disabled]="!canChangePassword() || passwordLoading()"
              (click)="changePassword()"
            >
              {{ passwordLoading() ? 'Cambiando…' : 'Cambiar Contraseña' }}
            </app-button>
          </div>
        </form>
      </div>
    } @else {
      <div class="bg-blue-50 border-2 border-blue-200 rounded-2xl shadow-xl p-8">
        <div class="flex items-center gap-4">
          <div class="bg-gradient-to-br from-blue-500 to-indigo-600 p-4 rounded-xl shadow-lg">
            <span class="material-symbols-outlined text-white text-4xl">info</span>
          </div>
          <div class="flex-1">
            <h2 class="text-2xl font-bold text-blue-900 mb-2">Autenticación de Terceros</h2>
            <p class="text-blue-700 leading-relaxed">
              Has iniciado sesión con un proveedor externo (como Google). La gestión de tu
              contraseña se realiza directamente con ese proveedor. No puedes cambiar tu contraseña
              desde aquí.
            </p>
          </div>
        </div>
      </div>
    }
  </div>
</app-section>

<!-- Account Management Section -->
<app-section spacing="xl" background="gray">
  <div class="max-w-3xl mx-auto">
    <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-4">Gestión de Cuenta</h2>
      <p class="text-gray-600">Opciones avanzadas para tu cuenta</p>
    </div>

    <div class="space-y-6">
      <!-- Security Info -->
      <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-md border border-gray-200 p-6">
        <div class="flex items-start gap-4">
          <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-3 rounded-xl shadow-lg">
            <span class="material-symbols-outlined text-white text-3xl">security</span>
          </div>
          <div class="flex-1">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Seguridad de la Cuenta</h3>
            <p class="text-gray-600 text-sm mb-3">
              Recomendamos usar una contraseña fuerte que incluya letras mayúsculas, minúsculas,
              números y símbolos especiales.
            </p>
            <ul class="text-sm text-gray-600 space-y-1">
              <li class="flex items-center gap-2">
                <span class="material-symbols-outlined text-green-600 text-sm">check</span>
                Al menos 8 caracteres
              </li>
              <li class="flex items-center gap-2">
                <span class="material-symbols-outlined text-green-600 text-sm">check</span>
                Combina letras y números
              </li>
              <li class="flex items-center gap-2">
                <span class="material-symbols-outlined text-green-600 text-sm">check</span>
                Incluye símbolos especiales
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Delete Account Warning -->
      @if (canShowDeleteOption()) {
        <div class="bg-red-50 border-2 border-red-200 rounded-xl shadow-md p-6">
          <div class="flex items-start gap-4">
            <div class="bg-gradient-to-br from-red-500 to-red-600 p-3 rounded-xl shadow-lg">
              <span class="material-symbols-outlined text-white text-3xl">warning</span>
            </div>
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-red-900 mb-2">Zona Peligrosa</h3>
              <p class="text-red-700 text-sm mb-4">
                Una vez que elimines tu cuenta, no hay vuelta atrás. Por favor, ten seguridad.
              </p>
              <app-button [variant]="'ghost'" [size]="'sm'" (click)="openDeleteModal()">
                Eliminar Cuenta
              </app-button>
            </div>
          </div>
        </div>
      } @else {
        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl shadow-md p-6">
          <div class="flex items-start gap-4">
            <div class="bg-gradient-to-br from-blue-500 to-indigo-600 p-3 rounded-xl shadow-lg">
              <span class="material-symbols-outlined text-white text-3xl">info</span>
            </div>
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-blue-900 mb-2">Gestión de Cuenta</h3>
              <p class="text-blue-700 text-sm">
                Tu cuenta es gestionada por los administradores de tu institución. Si necesitas
                eliminar tu cuenta o hacer cambios importantes, por favor contacta a tu
                administrador.
              </p>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</app-section>

<!-- Delete Account Modal -->
@if (showDeleteModal()) {
  <div
    class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    role="dialog"
    aria-modal="true"
    (click)="closeDeleteModal()"
    (keydown.escape)="closeDeleteModal()"
  >
    <div
      class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden"
      role="document"
      (click)="$event.stopPropagation()"
      (keydown)="$event.stopPropagation()"
    >
      <!-- Modal Header -->
      <div class="bg-gradient-to-r from-red-600 to-red-700 p-6">
        <div class="flex items-center gap-3">
          <span class="material-symbols-outlined text-white text-4xl">delete_forever</span>
          <h2 class="text-2xl font-bold text-white">Eliminar Cuenta</h2>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="p-6">
        <p class="text-gray-700 mb-4">
          Esta acción es <strong>irreversible</strong>. Se eliminarán permanentemente:
        </p>
        <ul class="space-y-2 mb-6">
          <li class="flex items-start gap-2 text-sm text-gray-600">
            <span class="material-symbols-outlined text-red-600 text-lg">close</span>
            Tu perfil y toda tu información personal
          </li>
          <li class="flex items-start gap-2 text-sm text-gray-600">
            <span class="material-symbols-outlined text-red-600 text-lg">close</span>
            Tu acceso a todas las funcionalidades
          </li>
          <li class="flex items-start gap-2 text-sm text-gray-600">
            <span class="material-symbols-outlined text-red-600 text-lg">close</span>
            Todos los datos asociados a tu cuenta
          </li>
        </ul>

        <form (submit)="$event.preventDefault(); deleteAccount()" class="space-y-4">
          <div>
            <app-input
              [label]="'Confirma tu contraseña para continuar'"
              [type]="'password'"
              [placeholder]="'Tu contraseña'"
              [icon]="'lock'"
              [value]="deletePassword()"
              (valueChange)="deletePassword.set($event)"
              [required]="true"
            />
          </div>

          @if (deleteError()) {
            <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
              {{ deleteError() }}
            </div>
          }
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="p-6 bg-gray-50 flex items-center justify-end gap-3">
        <app-button [variant]="'ghost'" [size]="'md'" (click)="closeDeleteModal()">
          Cancelar
        </app-button>
        <app-button
          [variant]="'primary'"
          [size]="'md'"
          [disabled]="!canDeleteAccount() || deleteLoading()"
          (click)="deleteAccount()"
        >
          {{ deleteLoading() ? 'Eliminando…' : 'Eliminar Mi Cuenta' }}
        </app-button>
      </div>
    </div>
  </div>
}
